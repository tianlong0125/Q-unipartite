#include <stdlib.h>#include <stdio.h>#include <time.h>#include "poc_uni.h"static int run = 1000;int main(int argc, char *argv[]){	int k, i, j, nl, N=1, n1,n2;	double p=0.01,wei,r;	double **A;	FILE *fp, *fp2;	int n = atoi(argv[1]);		A    = malloc(n*sizeof(double *));	A[0] = malloc(n*n*sizeof(double));	for (i=1; i<n; i++) A[i] = A[i-1] + n;			fp=fopen(argv[2], "r");	while (fscanf(fp,"%d %d %lf",&n1,&n2,&wei) != EOF) {		//printf("%d %d %f\n",n1,n2,wei);		A[n1-1][n2-1]=A[n2-1][n1-1]=1;		//fscanf(fp,"%d %d %d",&n1,&n2,&wei);	}	for (i = 0; i < n; i++) A[i][i] = 0;/*	for (i = 0; i < n; i++)		for (j = 0; j < n; j++) {			fscanf(fp, "%lf", &A[i][j]);			if(A[i][j] < 0.827) A[i][j] = 0;		}	fclose(fp);*/		int *compnt;	compnt=malloc(sizeof(int)*n);	int compnum = predivide(A,compnt,n);	printf("there are %d components\n", compnum);	if (compnum == 1) {		comstruct result;		double Qmax = 0;		for (i = 0; i < run; i++) {			result = uni(A, n);			printf("#%d, mod is %f\n", i, result.modularity);			if (result.modularity > Qmax) Qmax = result.modularity;			printf("current best Q is %g\n", Qmax);		}		//fp = fopen("community.txt", "w");		//for (i = 0; i < n; i++) fprintf(fp, "%d ", result.community[i]);		//fclose(fp);		free(result.community);		free(A[0]);		free(A);		return 0;	} 	int *compsize, *temp;	compsize = malloc(sizeof(int)*compnum);	temp = malloc(sizeof(int)*compnum);    for (i=0; i<compnum; i++) {        compsize[i] = 0;        temp[i] = 0;    }    for (i=0; i<n; i++) compsize[compnt[i]-1] += 1;    int **comp;    comp = malloc(sizeof(int *)*compnum);    for (i=0; i<compnum; i++) comp[i] = malloc(sizeof(int)*compsize[i]);        for (i=0; i<n; i++) {        //printf("%d ", compnt[i]);        comp[compnt[i]-1][temp[compnt[i]-1]] = i;        temp[compnt[i]-1] += 1;    }    free(temp);    for (i = 0; i < compnum; i++) {    	for (j = 0; j < compsize[i]; j++)    		printf("%d ", comp[i][j]+1);    	printf("\n");    }    int *partition;    partition = (int *)malloc(sizeof(int)*n);    int ncomm = 0;    for (i = 0; i < compnum; i++) {    	printf("size is %d\n", compsize[i]);    	if (compsize[i] < 4) {    		for (j = 0; j < compsize[i]; j++) partition[comp[i][j]] = ncomm+1;    		ncomm++;    		continue;    	}    	double **a;    	a = malloc(compsize[i]*sizeof(double *));    	for (j = 0; j < compsize[i]; j++) a[j] = malloc(compsize[i]*sizeof(double));    	for (j = 0; j < compsize[i]; j++) {    		a[j][j] = 0;    		for (k = j+1; k < compsize[i]; k++)    			a[j][k] = a[k][j] = A[comp[i][j]][comp[i][k]];    	}    	comstruct result = uni(a, compsize[i]);    	//printf("hello\n");    	int temp_nc = 1;    	for (j = 0; j < compsize[i]; j++) {    		if (result.community[j] > temp_nc) temp_nc = result.community[j];    		partition[comp[i][j]] = ncomm + result.community[j];    		free(a[j]);    	}    	free(result.community);    	ncomm += temp_nc;    	free(a);    }	//fp = fopen("community.txt", "w");	//for (i = 0; i < n; i++) fprintf(fp, "%d ", partition[i]);	//fclose(fp);	free(partition);		free(A[0]);	free(A);		return 0;}int predivide(double **a, int *compnt, int n){	int i, j, k=1;		for (i=0; i<n; i++) compnt[i] = 0;		for (i=0; i<n; i++) {		if (compnt[i] == 0) {			//printf("%d\n",i+1);			compnt[i] = k;			search(a, compnt, i, k, n);			k++;			//printf("\n\n\n");		}	}	//for (i=0; i<n; i++) printf("%d ",compnt[i]);		return k-1;	}void search(double **a, int *flag, int m1, int m2, int n){	int i,j;		for (i=0; i<n; i++) {		if (flag[i] == 0 && a[m1][i] > 0){			//printf("%d ",i+1);			flag[i] = m2;			search(a, flag, i, m2, n);		}	}		return;}